# 10_fpto_int测试计划

>**版本**：V1.0  
>**作者**：Oliver  
>**创建日期**：2025年8月24日  
>**最后更新**：2025年8月24日  

## 1. 测试概述

### 1.1 测试目标

- 验证基础单元输出符合IEEE 754标准
- 验证FP16/FP32->INT16/INT32数据转换功能
- 验证4单元并行转换阵列测试
- 验证边界值和特殊值的处理

### 1.2 测试覆盖率目标

- **功能覆盖率**：100%
- **代码覆盖率**：100%
- **特殊值覆盖率**：100%

---

## 2. 测试分类与用例

>`cru_fptoint_in = {inst_vld, src_prec, dst_prec, src_pos, dst_pos}`

### 2.1 tb_fpto_int_array.v 阵列测试

```markdown
Group 1: 4路FP32并行转INT32 
  `cru_fptoint_in = 11100`
  源精度: 32bit, 目的精度: 32bit
  测试输入0: 0x3f800000 -> 预期输出0: 0x00000001
  测试输入1: 0xbf800000 -> 预期输出1: 0xffffffff
  测试输入2: 0x42f70000 -> 预期输出2: 0x0000007b
  测试输入3: 0xc3e4cccd -> 预期输出3: 0xfffffe37

Group 2: 4路FP32转INT16含饱和
  `cru_fptoint_in = 11000`
  源精度: 32bit, 目的精度: 16bit
  测试输入0: 0x3f800000 -> 预期输出0: 0x00000001
  测试输入1: 0x47000000 -> 预期输出1: 0x00007fff
  测试输入2: 0xc7000080 -> 预期输出2: 0x00008000
  测试输入3: 0x41200000 -> 预期输出3: 0x0000000a

Group 3.1: 4路FP16转INT32低位
  `cru_fptoint_in = 10100`
  源精度: 16bit, 目的精度: 32bit
  测试输入0: 0x00003c00 -> 预期输出0: 0x00000001
  测试输入1: 0x0000c000 -> 预期输出1: 0xfffffffe
  测试输入2: 0x00004200 -> 预期输出2: 0x00000003
  测试输入3: 0x0000c500 -> 预期输出3: 0xfffffffb

Group 3.2: 4路FP16转INT32高位
  `cru_fptoint_in = 10110`
  源精度: 16bit, 目的精度: 32bit
  测试输入0: 0x3c000000 -> 预期输出0: 0x00000001
  测试输入1: 0xc0000000 -> 预期输出1: 0xfffffffe
  测试输入2: 0x42000000 -> 预期输出2: 0x00000003
  测试输入3: 0xc5000000 -> 预期输出3: 0xfffffffb

Group 4: 4路FP16转INT16
  `cru_fptoint_in = 10000`
  源精度: 16bit, 目的精度: 16bit
  测试输入0: 0x00003c00 -> 预期输出0: 0x00000001
  测试输入1: 0x00004000 -> 预期输出1: 0x00000002
  测试输入2: 0x00004200 -> 预期输出2: 0x00000003
  测试输入3: 0x00004400 -> 预期输出3: 0x00000004

Group 5: 4子字并行FP16转INT16 //8路FP16转INT16
  `cru_fptoint_in = 10000`
  源精度: 16bit, 目的精度: 16bit
  测试输入0: 0x40003c00 -> 预期输出0: 0x00020001
  测试输入1: 0x44004200 -> 预期输出1: 0x00040003
  测试输入2: 0xc600c500 -> 预期输出2: 0xfffafffb
  测试输入3: 0x48004700 -> 预期输出3: 0x00080007

Group 6: 4路特殊值处理
  `cru_fptoint_in = 11100`
  源精度: 32bit, 目的精度: 32bit
  测试输入0: 0x00000000 -> 预期输出0: 0x00000000
  测试输入1: 0x7f800000 -> 预期输出1: 0x80000000
  测试输入2: 0xff800000 -> 预期输出2: 0x80000000
  测试输入3: 0x7fc00000 -> 预期输出3: 0x80000000

Group 7: 指令无效处理
  `cru_fptoint_in = 00000`
  所有输出应保持原值
  测试输入0: 0x3F800000 -> 预期输出0: 0x3F800000
  测试输入1: 0x40000000 -> 预期输出1: 0x40000000
  测试输入2: 0x40400000 -> 预期输出2: 0x40400000
  测试输入3: 0x40800000 -> 预期输出3: 0x40800000

```

### 2.2 tb_fpto_int.v 基础单元测试

> 50个固定测试+2000个随机测试

```markdown
- 50个固定测试
Group 1 : FP32转换测试 (0-19)
    基础01: FP32(1.0) -> INT32
    基础02: FP32(-1.0) -> INT32
    基础03: FP32(123.5) -> INT32
    基础04: FP32(-456.8) -> INT32
    基础05: FP32(0.0) -> INT32
    基础06: FP32(+INF) -> INT32
    基础07: FP32(-INF) -> INT32
    基础08: FP32(NaN) -> INT32
    基础09: FP32(1.0) -> INT16
    基础10: FP32(32768.0) -> INT16饱和
    基础11: FP32(-32769.0) -> INT16饱和
    基础12: FP32(1.0) -> INT16高位
    基础13: FP32(10.0) -> INT16
    基础14: FP32(-10.0) -> INT16
    基础15: FP32(10000.0) -> INT16
    基础16: FP32(2147483648.0) -> INT16饱和
    基础17: FP32(-2147483648.0) -> INT16饱和
    基础18: FP32最小正规格数 -> INT32
    基础19: FP32最小负规格数 -> INT32
    基础20: FP32最大非规格数 -> INT32

Group 2 : FP16转换测试 (20-34)
    基础21: FP16(1.0)低位 -> INT32
    基础22: FP16(1.0)高位 -> INT32
    基础23: FP16(-2.0) -> INT32
    基础24: FP16(3.0) -> INT16
    基础25: FP16(-5.0) -> INT16
    基础26: FP16(1.0)高位 -> INT16高位
    基础27: FP16(+INF) -> INT32
    基础28: FP16(-INF) -> INT32
    基础29: FP16(NaN) -> INT32
    基础30: FP16(0.0) -> INT32
    基础31: FP16最大值 -> INT32
    基础32: FP16最小值 -> INT32
    基础33: FP16最小正规格数 -> INT32
    基础34: FP16最小负规格数 -> INT32
    基础35: FP16最大非规格数 -> INT32

Group 3 : 子字并行测试 (35-44)  //8路并行FP16转INT16
    子字01: 并行FP16(2.0,1.0) -> INT16
    子字02: 并行FP16(4.0,3.0) -> INT16
    子字03: 并行FP16(-6.0,-5.0) -> INT16
    子字04: 并行FP16(8.0,7.0) -> INT16
    子字05: 并行FP16(INF,1.0) -> INT16
    子字06: 并行FP16(-INF,-2.0) -> INT16
    子字07: 并行FP16(NaN,NaN) -> INT16
    子字08: 并行FP16(0.0,0.0) -> INT16
    子字09: 并行FP16(最大,1.0) -> INT16
    子字10: 并行FP16(最小,-2.0) -> INT16

Group 4 : 边界值测试 (45-49)
    边界01: FP32接近INT16上限 -> INT32
    边界02: FP32接近INT16下限 -> INT32
    边界03: FP32接近INT32上限 -> INT32
    边界04: FP32接近INT32下限 -> INT32
    边界05: FP32很小的数 -> INT32

```

---

## 3. 测试环境与工具

### 3.1 仿真环境

```markdown
仿真器：VCS (Synopsys)
语言：SystemVerilog + DPI-C
波形：FSDB格式
覆盖率：代码覆盖率 + 功能覆盖率
```

### 3.2 参考模型

```markdown
参考库：Berkeley SoftFloat-3
接口：DPI-C函数调用
对比精度：位级精确匹配
异常验证：标志位完全一致
```

---

### 4. 验收标准

- [ ] 代码覆盖率 ≥95%
- [ ] 功能覆盖率 ≥95%
- [ ] 所有数据转换结果符合IEEE 754标准
- [ ] 基本单元功能验证通过
- [ ] 阵列测试单元并行处理验证通过
- [ ] 边界值与特殊值处理符合规范
- [ ] 无任何已知功能缺陷

**测试计划版本历史**：

- V1.0：2025-08-24 - 初版  

**责任人**：XXX  
**预计完成**：2025年9月9日  
