
###  testplan.md

#  子字并行浮点加法器测试计划

> **版本**：v1.1  
> **作者**：cypher  
> **覆盖**：功能正确性、边界条件、特殊值处理、流水线行为

---

## 1. 验证目标
| 类别 | 描述 |
|------|------|
| **功能正确性** | 加法结果与 SoftFloat 黄金模型一致 |
| **特殊值处理** | NaN、Inf、±0、denormals 符合 IEEE 754 |
| **边界条件** | 最大/最小数、指数差极限、舍入边界 |
| **流水线状态** | 状态机复位、背靠背操作、非空闲指令处理 |
| **覆盖率** | 行≥95%，分支≥90%，特殊值 100% |

---

## 2. 测试方法
| 方法 | 描述 |
|------|------|
| **参考模型** | SoftFloat DPI-C |
| **自检测试** | ULP 容差 ≤ 1 即通过 |
| **随机测试** | 30 组 FP16 / FP32 随机数据 |
| **波形检查** | Verdi 调试 |
| **覆盖率收集** | VCS / URG |

---

## 3. 测试场景

### 3.1 基本功能测试
| ID | 场景 | 输入（十六进制） | 预期结果 |
|----|------|------------------|----------|
| BF-01 | FP16 1.0+1.0 | 0x3C00, 0x3C00 | 0x4000 |
| BF-02 | FP32 1.0+(-1.0) | 0x3F800000, 0xBF800000 | 0x00000000 |
| BF-03 | 连续加法 | 背靠背 `cru_fpadd[0]=1` | 状态机无阻塞 |

### 3.2 特殊值测试
| ID | 场景 | 输入（十六进制） | 预期结果 |
|----|------|------------------|----------|
| SP-01 | NaN 传播 | NaN + 任意值 | NaN |
| SP-02 | Inf 加法 | +Inf + +Inf | +Inf |
| SP-03 | Inf 冲突 | +Inf + -Inf | NaN |
| SP-04 | Zero 合并 | +0 + -0 | +0 |
| SP-05 | Denorm 进位 | 0x03FF + 0x03FF | 0x0400 |

### 3.3 边界值测试
| ID | 场景 | 输入（十六进制） | 预期结果 |
|----|------|------------------|----------|
| BV-01 | FP16 最大值溢出 | 0x7BFF + 0x7BFF | 0x7C00 (Inf) |
| BV-02 | FP32 最大值溢出 | 0x7F7FFFFF + 0x7F7FFFFF | 0x7F800000 (Inf) |
| BV-03 | 指数差极限 | exp 差 = 30 | 尾数正确移位 |
| BV-04 | 最小非规格化数 | 0x0001 + 0x0001 | 0x0002 |

### 3.4 舍入测试
| ID | 场景 | 输入（十六进制） | 预期结果 |
|----|------|------------------|----------|
| RD-01 | 向偶数舍入 | 尾数=0x1FF, round=1, sticky=0 | 舍入到 0x200 |
| RD-02 | 尾数进位 | 0x3BFF + 0x3BFF | 触发 carry_out |
| RD-03 | 非规格化舍入 | denorm 相加后规格化 | 正确舍入位处理 |

### 3.5 流水线测试
| ID | 场景 | 操作 | 预期结果 |
|----|------|------|----------|
| SM-01 | 复位中断 | `PROC` 状态强制复位 | 返回 `IDLE` |
| SM-02 | 背靠背操作 | 连续 `cru_fpadd[0]=1` | 正确流水线处理 |
| SM-03 | 非空闲指令 | `DONE` 状态输入新指令 | 忽略并等待 |

### 3.6 随机测试
| 类型 | 数量 | 说明 |
|------|------|------|
| FP16 随机 | 30 组 | 全随机 16 位数据 |
| FP32 随机 | 30 组 | 全随机 32 位数据 |

---

## 4. 验证环境
| 工具 | 用途 |
|------|------|
| **VCS** | RTL 仿真 |
| **Verdi** | 波形调试 |
| **SoftFloat** | 黄金参考模型 |
| **URG** | 覆盖率分析 |

---

## 5. 回归策略
- 每次 RTL 修改后运行完整测试集。
- 保留历史 bug 用例作为回归测试。
- 覆盖率不达标禁止合入主干。

---

## 6. 验收标准
| 指标 | 要求 |
|------|------|
| 功能测试通过率 | 100% |
| 行覆盖率 | ≥95% |
| 分支覆盖率 | ≥90% |
| 特殊值处理 | 100% IEEE 754 合规 |
| 已知缺陷 | 0 |

---

## 附录：关键覆盖点
| 覆盖组 | 覆盖点 |
|--------|--------|
| **指数对齐** | 指数差 0~30 |
| **舍入边界** | round=1 且 sticky=0/1 |
| **特殊值组合** | NaN+Inf, Inf+Inf, +0+-0 |
| **非规格化数** | denorm+denorm→规格化 |
| **符号组合** | 同号 / 异号 / 零符号 |
