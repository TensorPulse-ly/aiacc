
##  LDB_ENGINE 测试计划（testplan.md）

### 1. 引言
覆盖 LDB_ENGINE 所有功能路径，包括：
- 微指令解析与状态机跳转
- 多 SMC 并行写入
- 字节掩码处理
- 突发传输边界
- AXI-Lite 主接口协议合规

---

### 2. 验证目标

| 目标类别       | 描述 |
|----------------|------|
| **功能正确性** | 所有测试用例输出与预期一致 |
| **协议合规性** | AXI-Lite 主接口握手正确 |
| **边界鲁棒性** | 突发长度为 0/最大/奇数等 |
| **并行性验证** | 多 SMC 并行写入无冲突 |
| **覆盖率**     | 行 ≥95%，分支 ≥90%，FSM 100% |

---

### 3. 测试方法

| 方法         | 工具/实现 |
|--------------|-----------|
| **定向测试** | 边界值、掩码组合、突发长度 |
| **协议检查** | VCS + Verdi 波形分析 |
| **覆盖率**   | VCS + URG |
| **回归策略** | 每次 RTL 修改触发全量测试 |

---

### 4. 测试场景

#### 4.1 微指令解析测试

| ID | 场景 | 验证点 |
|----|------|--------|
| UC-01 | 单 SMC 完整突发 | `smc_strb=000001`，`brst=4` |
| UC-02 | 多 SMC 并行 | `smc_strb=000111`，`brst=2` |
| UC-03 | 掩码屏蔽低字节 | `byte_strb=0011`，仅写入低 2 Byte |

#### 4.2 AXI-Lite 协议测试

| ID | 场景 | 验证点 |
|----|------|--------|
| AX-01 | 地址握手失败 | `arvalid=1` 但 `arready=0` |
| AX-02 | 数据握手延迟 | `rvalid=1` 但 `rready=0` |
| AX-03 | 连续突发地址正确 | 验证地址累加逻辑 |

#### 4.3 边界测试

| ID | 场景 | 验证点 |
|----|------|--------|
| BT-01 | 突发长度为 0 | 状态机不进入 DATA_RCV |
| BT-02 | 突发长度为 65535 | 不溢出，地址正确 |
| BT-03 | smc_strb 有 0 | 跳过未使能 SMC |
| BT-04 | byte_strb 全 0 | 不写入任何字节 |

#### 4.4 并发与状态机测试

| ID | 场景 | 验证点 |
|----|------|--------|
| ST-01 | 连续指令 | 第二条指令在前一条未完成时拉高 |
| ST-02 | DONE 状态残留 rvalid | 确保状态机正确回 IDLE |

---

### 5. 验证环境

| 工具   | 用途 |
|--------|------|
| VCS    | RTL 编译与仿真 |
| Verdi  | 波形调试 |
| URG    | 覆盖率分析 |
| Python | 自动生成测试向量（可选） |

---

### 6. 回归策略

- 每次 RTL 修改触发全量测试
- 缺陷用例加入回归池
- 覆盖率未达标阻塞合入

---

### 7. 验收标准

| 指标         | 要求 |
|--------------|------|
| 功能通过率   | 100% |
| 行覆盖率     | ≥95% |
| 分支覆盖率   | ≥90% |
| FSM 覆盖率   | 100% |
| 致命缺陷     | 0 |

---

### 8. 快速运行

```bash
./run_sim.sh
# 查看 sim.log 和 coverage_report/dashboard.html
```
