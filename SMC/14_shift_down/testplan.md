# SHIFT_UP 模块测试计划

>**版本**：V1.0  
>**作者**：Oliver  
>**创建日期**：2025年8月16日  
>**最后更新**：2025年8月16日  

## 1. 测试概述

### 1.1 测试目标

- 验证级联移位寄存器的指令传递逻辑
- 测试数据分发机制
- 验证复位和无效指令处理功能

### 1.2 测试覆盖率目标

- **功能覆盖率**：100%
- **代码覆盖率**：100%
- **特殊值覆盖率**：100%

---

## 2. 测试分类与用例

### 2.1 复位功能测试

| 用例ID | 描述                   | 测试输入 (dvr_shiftdn_in) | 测试输入 (crd_shiftdn_in)                     | 预期输出 (crd_shiftdn_out)          |
|--------|------------------------|---------------------------|----------------------------------------------|-------------------------------------|
| RS-01 | 复位后输出为零         | 128'd0                    | {1'b0, 128'd0, 5'd0}                         | {1'b0, 128'd0, 5'd0}               |

---

### 2.2 指令传递测试 (SMC_ID > 模块ID)

| 用例ID | 描述                           | 测试输入 (dvr_shiftdn_in) | 测试输入 (crd_shiftdn_in)                               | 预期输出 (crd_shiftdn_out)                 |
|--------|--------------------------------|---------------------------|--------------------------------------------------------|-------------------------------------------|
| PA-01| SMC_ID+1 > 模块ID (传递指令)   | 128'd0                    | {1'b1, 128'hA5A5_A5A5_..._A5A5, TEST_SMC_ID+1}         | {1'b1, 128'hA5A5_..._A5A5, TEST_SMC_ID+1} |
| PA-02| SMC_ID+2 > 模块ID (传递指令)   | 128'd0                    | {1'b1, 128'hB6B6_B6B6_..._B6B6, TEST_SMC_ID+2}         | {1'b1, 128'hB6B6_..._B6B6, TEST_SMC_ID+2} |

---

### 2.3 数据保存测试 (SMC_ID 匹配)

| 用例ID | 描述                         | 测试输入 (dvr_shiftdn_in)           | 测试输入 (crd_shiftdn_in)                     | 预期输出 (crd_shiftdn_out)               |
|--------|------------------------------|-------------------------------------|----------------------------------------------|-------------------------------------------|
| DS-01| SMC_ID 匹配时保存数据        | 128'h1234_5678_..._DEF0             | {1'b1, 128'hFFFF_..._FFFF, TEST_SMC_ID}      | {1'b1, 128'h1234_..._DEF0, TEST_SMC_ID}  |
| DS-02| 再次匹配时更新数据           | 128'hCAFE_BABE_..._BABE             | {1'b1, 128'd0, TEST_SMC_ID}                  | {1'b1, 128'hCAFE_..._BABE, TEST_SMC_ID} |

---

### 2.4 SMC_ID 小于模块ID测试

| 用例ID | 描述                         | 测试输入 (dvr_shiftdn_in)           | 测试输入 (crd_shiftdn_in)                     | 预期输出 (crd_shiftdn_out)               |
|--------|------------------------------|-------------------------------------|----------------------------------------------|-------------------------------------------|
| SM-01| SMC_ID-1 < 模块ID (保持数据) | 128'hBAD0_BAD0_..._BAD0             | {1'b1, 128'h2222_..._2222, TEST_SMC_ID-1}    | {1'b1, 128'h1111_..._1111, TEST_SMC_ID}  |
| SM-02| SMC_ID-2 < 模块ID (保持数据) | 128'hBAD0_BAD0_..._BAD0             | {1'b1, 128'h3333_..._3333, TEST_SMC_ID-2}    | {1'b1, 128'h1111_..._1111, TEST_SMC_ID}  |

---

### 2.5 多周期连续测试

| 用例ID | 描述                                | 测试输入 (dvr_shiftdn_in) | 测试输入 (crd_shiftdn_in)                     | 预期输出 (crd_shiftdn_out)               |
|--------|-------------------------------------|---------------------------|----------------------------------------------|-------------------------------------------|
| MC-01  | 传递指令 (SMC_ID+1 > 模块ID)        | 128'd0                    | {1'b1, 128'h4444_..._4444, TEST_SMC_ID+1}    | {1'b1, 128'h4444_..._4444, TEST_SMC_ID+1}|
| MC-02  | 保存数据 (SMC_ID 匹配)              | 128'h5555_..._5555        | {1'b1, 128'hFFFF_..._FFFF, TEST_SMC_ID}      | {1'b1, 128'h5555_..._5555, TEST_SMC_ID}  |
| MC-03  | 保持数据 (SMC_ID-1 < 模块ID)        | 128'h6666_..._6666        | {1'b1, 128'h7777_..._7777, TEST_SMC_ID-1}    | {1'b1, 128'h5555_..._5555, TEST_SMC_ID}  |
| MC-04  | 再次传递 (SMC_ID+3 > 模块ID)        | 128'd0                    | {1'b1, 128'h8888_..._8888, TEST_SMC_ID+3}    | {1'b1, 128'h8888_..._8888, TEST_SMC_ID+3}|

---

### 2.6 无效指令测试

| 用例ID | 描述                             | 测试输入 (dvr_shiftdn_in) | 测试输入 (crd_shiftdn_in)                     | 预期输出 (crd_shiftdn_out)               |
|--------|----------------------------------|---------------------------|----------------------------------------------|-------------------------------------------|
| IN-01 | vld=0 且 SMC_ID 匹配 (保持数据)  | 128'd0                    | {1'b0, 128'hBBBB_..._BBBB, TEST_SMC_ID}      | {1'b1, 128'h9999_..._9999, TEST_SMC_ID}  |
| IN-02 | vld=0 且 SMC_ID+1 > 模块ID       | 128'd0                    | {1'b0, 128'hCCCC_..._CCCC, TEST_SMC_ID+1}    | {1'b1, 128'h9999_..._9999, TEST_SMC_ID}  |

---

### 关键说明

1. **TEST_SMC_ID 值**：测试中固定为 `3`（模块实例化参数）
2. **数据格式**：
   - `crd_shiftdn_in` = `{vld_in, data_in, smc_id_in}`
   - `crd_shiftdn_out` = `{vld_out, data_out, smc_id_out}`
3. **特殊行为**：
   - SMC_ID 匹配时：`data_out` = `dvr_shiftdn_in`
   - SMC_ID > 模块ID：`data_out` = `data_in`
   - SMC_ID < 模块ID 或 vld=0：保持前值
4. **缩写约定**：
   - `128'hA5A5_..._A5A5` 表示完整 128 位数据
   - `TEST_SMC_ID` 简写为模块ID (值=3)

## 3. 测试环境与工具

- 仿真器：VCS
- 语言：Verilog
- 覆盖率：代码覆盖率 + 功能覆盖率

### 4. 验收标准

- [ ] 代码覆盖率 ≥95%
- [ ] 功能覆盖率 ≥95%
- [ ] 所有控制路径验证通过
- [ ] 特殊值处理符合规范
- [ ] 无任何已知功能缺陷

**测试计划版本历史**：

- V1.0：2025-08-16 - 初版  

**责任人**：XXX  
**预计完成**：2025年8月25日  

> 附件:
>
> 1. [代码shift_up.v](./vsrc/shift_down.v)
> 2. [测试平台tb_shift_up.v](./vsrc/tb_shift_down.v)
