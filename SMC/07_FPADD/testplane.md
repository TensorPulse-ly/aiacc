# 子字并行浮点加法器测试计划（testplan.md）

## 1. 引言
本测试计划覆盖FP16×8/FP32×4子字并行加法器的功能正确性、边界条件、特殊值处理与流水线行为验证。

## 2. 验证目标
| 目标类别 | 描述 |
|----------|------|
| **功能正确性** | 加法结果与SoftFloat黄金模型一致 |
| **特殊值处理** | NaN、Inf、±0、denormals符合IEEE 754 |
| **边界条件** | 最大/最小数、指数差极限、舍入边界 |
| **流水线状态** | 状态机复位、背靠背操作、非空闲指令处理 |
| **覆盖率** | 行覆盖率≥95%，分支覆盖率≥90% |

## 3. 测试方法
| 方法 | 描述 |
|------|------|
| **参考模型** | SoftFloat DPI-C |
| **自检测试** | ULP容差≤1即通过 |
| **随机测试** | 30组FP16/FP32随机数据 |
| **波形检查** | Verdi调试 |
| **覆盖率收集** | VCS/URG |

## 4. 测试场景

### 4.1 基本功能测试
| ID | 场景 | 输入 | 预期结果 |
|----|------|------|----------|
| BF-01 | FP16 1.0+1.0 | 0x3C00, 0x3C00 | 0x4000 |
| BF-02 | FP32 1.0+(-1.0) | 0x3F800000, 0xBF800000 | 0x00000000 |
| BF-03 | 连续加法 | 背靠背inst_valid | 状态机无阻塞 |

### 4.2 特殊值测试
| ID | 场景 | 输入 | 预期结果 |
|----|------|------|----------|
| SP-01 | NaN传播 | NaN + 任意值 | NaN |
| SP-02 | Inf加法 | +Inf + +Inf | +Inf |
| SP-03 | Inf冲突 | +Inf + -Inf | NaN |
| SP-04 | Zero合并 | +0 + -0 | +0 |
| SP-05 | Denorm进位 | 0x03FF + 0x03FF → 规格化 | 0x0400 |

### 4.3 边界值测试
| ID | 场景 | 输入 | 预期结果 |
|----|------|------|----------|
| BV-01 | FP16最大值溢出 | 0x7BFF + 0x7BFF | 0x7C00 (Inf) |
| BV-02 | FP32最大值溢出 | 0x7F7FFFFF + 0x7F7FFFFF | 0x7F800000 (Inf) |
| BV-03 | 指数差极限 | exp差=30 | 尾数正确移位 |
| BV-04 | 最小非规格化数 | 0x0001 + 0x0001 | 0x0002 |

### 4.4 舍入测试
| ID | 场景 | 输入 | 预期结果 |
|----|------|------|----------|
| RD-01 | 向偶数舍入 | 尾数=0x1FF, round=1, sticky=0 | 舍入到0x200 |
| RD-02 | 尾数进位 | 0x3BFF + 0x3BFF | 触发carry_out |
| RD-03 | 非规格化舍入 | denorm相加后规格化 | 正确舍入位处理 |

### 4.5 流水线测试
| ID | 场景 | 操作 | 预期结果 |
|----|------|------|----------|
| SM-01 | 复位中断 | PROC状态强制复位 | 返回IDLE |
| SM-02 | 背靠背操作 | 连续inst_valid | 正确流水线处理 |
| SM-03 | 非空闲指令 | DONE状态输入新指令 | 忽略并等待 |

### 4.6 随机测试
| 类型 | 数量 | 说明 |
|------|------|------|
| FP16随机 | 30组 | 全随机16位数据 |
| FP32随机 | 30组 | 全随机32位数据 |

## 5. 验证环境
| 工具 | 用途 |
|------|------|
| **VCS** | RTL仿真 |
| **Verdi** | 波形调试 |
| **SoftFloat** | 黄金参考模型 |
| **URG** | 覆盖率分析 |

## 6. 回归策略
- 每次RTL修改后运行完整测试集
- 保留历史bug用例作为回归测试
- 覆盖率不达标禁止合入主干

## 7. 验收标准
| 指标 | 要求 |
|------|------|
| 功能测试通过率 | 100% |
| 行覆盖率 | ≥95% |
| 分支覆盖率 | ≥90% |
| 特殊值处理 | 100% IEEE 754合规 |
| 已知缺陷 | 0 |

## 附录：关键覆盖点
| 覆盖组 | 覆盖点 |
|--------|--------|
| **指数对齐** | 指数差0~30 |
| **舍入边界** | round=1且sticky=0/1 |
| **特殊值组合** | NaN+Inf, Inf+Inf, +0+-0 |
| **非规格化数** | denorm+denorm→规格化 |
| **符号组合** | 同号/异号/零符号 |