# RUR 模块测试计划（RUR_testplan.md）

> **版本**：v1.1  
> **作者**：cypher  
> **覆盖**：97-bit 指令解析、8×256×128-bit UR-RAM 读写、掩码控制、边界场景

---

## 1. 引言
覆盖 **RUR 模块**全功能测试，包括指令解析、通道寻址、掩码提取、OR 累积写入、边界地址与掩码验证。

---

## 2. 验证目标
| 目标类别 | 描述 |
|----------|------|
| **指令解析正确性** | 97-bit 字段（vld/smc_id/ur_id/ur_addr/lo）正确解析 |
| **通道寻址正确性** | 8 个通道独立寻址，256 地址全覆盖 |
| **掩码提取正确性** | 16 组 8-bit 掩码按子地址提取 |
| **OR 累积写入** | 多次指令结果正确 OR |
| **边界鲁棒性** | ur_addr=0/255、子地址=0/15、全 vld=0/1 |
| **覆盖率** | 行≥95%，分支≥90%，功能点 100% |

---

## 3. 测试方法
| 方法 | 工具/实现 |
|------|-----------|
| **参考模型** | SystemVerilog 任务 `update_ref()` |
| **定向测试** | 边界地址（0x00, 0xFF）、全掩码、零掩码 |
| **随机测试** | 100 组随机指令（有效 SMC_ID） |
| **错误注入** | 20 组 SMC_ID 不匹配指令 |
| **边界测试** | 10 组全掩码/零掩码/子地址=15 |
| **波形检查** | Verdi 信号分析 |
| **覆盖率收集** | VCS/URG |

---

## 4. 测试场景

### 4.1 基础功能测试
| ID | 场景 | 输入示例 |
|----|------|----------|
| BF-01 | 单通道单字节提取 | ur_id=3, ur_addr=0x42, lo[0]={addr=5,vld=1} → dr_rur_d[7:0]=ram[3][0x42][39:32] |
| BF-02 | 多通道多字节提取 | 连续 8 条指令，每个通道各提取 1 字节 |
| BF-03 | OR 累积写入 | 先后两条指令写入不同字节，结果正确 OR |

### 4.2 边界测试
| ID | 场景 | 关键验证点 |
|----|------|-------------|
| BD-01 | ur_addr=0xFF | 通道 7，地址 255，提取 16 字节 |
| BD-02 | 子地址=15 | 提取 ram[7][255][127:120] |
| BD-03 | 全 vld=0 | 输出保持不变 |
| BD-04 | 全 vld=1 | 提取并 OR 所有 16 字节 |

### 4.3 SMC_ID 过滤测试
| ID | 场景 | 触发条件 |
|----|------|----------|
| SC-01 | SMC_ID 不匹配 | smc_id≠3，输出不变 |
| SC-02 | SMC_ID 匹配 | smc_id=3，正常执行 |

### 4.4 随机测试
| ID | 场景 | 描述 |
|----|------|------|
| RD-01 | 随机指令 | 100 组随机 ur_id/ur_addr/lo |
| RD-02 | 随机数据 | UR-RAM 初始化随机 128-bit 数据 |

---

## 5. 验证环境
| 工具 | 用途 |
|------|------|
| VCS | RTL 编译/仿真 |
| Verdi | 波形调试 |
| URG | 覆盖率分析 |
| SystemVerilog | 参考模型与测试平台 |

---

## 6. 回归策略
- 代码更新后自动触发全量测试集
- 历史缺陷用例加入回归池（如边界地址、全掩码）
- 覆盖率未达标阻塞代码合入

---

## 7. 验收标准
| 指标 | 要求 |
|------|------|
| 功能通过率 | 100% |
| 行覆盖率 | ≥95% |
| 分支覆盖率 | ≥90% |
| 边界用例 | 100% 覆盖 |
| 致命缺陷 | 0 |

---

## 附录：关键覆盖点
| 覆盖组 | 覆盖目标 |
|--------|----------|
| **通道寻址** | 8 个通道全覆盖 |
| **地址边界** | 0x00 与 0xFF |
| **子地址边界** | 0 与 15 |
| **掩码控制** | 全 0、全 1、随机组合 |
| **SMC_ID 过滤** | 匹配与不匹配 |
