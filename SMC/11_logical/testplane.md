
###  逻辑单元测试计划 (testplan.md)  

#### 1. 引言  
覆盖逻辑单元全功能测试，包括基础逻辑操作、选择器决策、移位边界处理及浮点状态集成验证。  

#### 2. 验证目标  
| 目标类别 | 描述 |  
|----------|------|  
| **功能正确性** | 输出与SoftFloat参考模型一致 |  
| **精度兼容性** | 16-bit/32-bit模式无缝切换 |  
| **边界鲁棒性** | 移位量超限、符号扩展、零值输入 |  
| **浮点集成** | `fpadd_status_i`决策正确性 |  
| **覆盖率** | 行覆盖≥95%，分支覆盖≥90% |  

#### 3. 测试方法  
| 方法 | 工具/实现 |  
|------|------------|  
| **参考模型** | SoftFloat DPI-C（`fp32_compare_softfloat`） |  
| **定向测试** | 边界值/特殊场景（NaN, Inf） |  
| **随机测试** | 50组随机操作数+操作码组合 |  
| **波形检查** | Verdi信号分析 |  
| **覆盖率收集** | VCS/URG |  

#### 4. 测试场景  
**4.1 基础逻辑测试**  
| ID | 场景 | 输入示例 |  
|----|------|----------|  
| BL-01 | 32-bit AND | `src0=0xA5A5A5A5`, `src1=0x0F0F0F0F` → 0x05050505 |  
| BL-02 | 16-bit XOR | `src0[15:0]=0xFFFF`, `src1[15:0]=0x1234` → 0x0000EDCB |  
| BL-03 | NOT操作 | `src0=0xDEADBEEF` → 0x21524110 |  

**4.2 选择器测试**  
| ID | 场景 | 触发条件 |  
|----|------|----------|  
| SL-01 | 选较大值（GT） | `fpadd_status_i[2]=1` → 输出`src0` |  
| SL-02 | 等值选择（EQ） | `fpadd_status_i[1]=1` → 输出`src0` |  
| SL-03 | Inf比较决策 | `+Inf == -Inf` → 触发NaN决策 |  

**4.3 移位操作测试**  
| ID | 场景 | 关键验证点 |  
|----|------|-------------|  
| SH-01 | 逻辑右移超界 | 32-bit右移31位 → 高位补0 |  
| SH-02 | 算术右移符号扩展 | 16-bit负数右移 → 符号位填充高16位 |  
| SH-03 | 旋转移位循环性 | 16-bit数据旋转12位 → 等效左移4位 |  

**4.4 浮点状态集成测试**  
| ID | 场景 | 预期行为 |  
|----|------|----------|  
| FP-01 | 浮点状态冲突 | `fpadd_status_i=3'b101` → 优先选择GT |  
| FP-02 | 非浮点操作忽略状态 | 基础逻辑操作中`fpadd_status_i`无效 |  

#### 5. 验证环境  
| 工具 | 用途 |  
|------|------|  
| VCS | RTL编译/仿真 |  
| Verdi | 波形调试 |  
| SoftFloat | 黄金参考模型 |  
| URG | 覆盖率分析 |  

#### 6. 回归策略  
- 代码更新后自动触发全量测试集  
- 历史缺陷用例加入回归池（e.g., 符号扩展缺陷BV-03）  
- 覆盖率未达标阻塞代码合入  

#### 7. 验收标准  
| 指标 | 要求 |  
|------|------|  
| 功能通过率 | 100% |  
| 行覆盖率 | ≥95% |  
| 边界用例 | 100%覆盖 |  
| 致命缺陷 | 0 |  

#### 附录：关键覆盖点  
| 覆盖组 | 覆盖目标 |  
|--------|----------|  
| **移位方向** | 左移/右移全组合 |  
| **精度切换** | 16-bit/32-bit模式切换 |  
| **浮点状态** | `fpadd_status_i`三位独立覆盖 |  
| **符号扩展** | 负数算术右移高位补1 |  

> ✅ 通过执行 `./run_sim.sh` 一键验证（需预先配置VCS+SoftFloat环境）  