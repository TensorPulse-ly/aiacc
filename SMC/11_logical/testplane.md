###  逻辑单元测试计划 (testplan.md)  

> **版本**：v1.1  
> **作者**：cypher 
> **覆盖**：128-bit SIMD 逻辑/移位/选择操作，支持32-bit×4通道或16-bit×8通道，单周期执行  

#### 1. 引言  
覆盖 **128-bit SIMD 逻辑单元**全功能测试，包括基础逻辑操作、选择器决策、移位边界处理及浮点状态集成验证。  

#### 2. 验证目标  
| 目标类别 | 描述 |  
|----------|------|  
| **功能正确性** | 输出与SoftFloat参考模型一致 |  
| **精度兼容性** | 16-bit×8通道/32-bit×4通道模式无缝切换 |  
| **边界鲁棒性** | 移位量超限、符号扩展、零值输入、全1输入 |  
| **浮点集成** | `dvr_logic_st`每通道3位决策正确性 |  
| **覆盖率** | 行覆盖≥95%，分支覆盖≥90% |  

#### 3. 测试方法  
| 方法 | 工具/实现 |  
|------|------------|  
| **参考模型** | SoftFloat DPI-C（`fp32_compare_softfloat`/`fp16_compare_softfloat`） |  
| **定向测试** | 边界值/特殊场景（全0、全1、NaN、Inf） |  
| **随机测试** | 50组随机操作数+操作码组合 |  
| **波形检查** | Verdi信号分析 |  
| **覆盖率收集** | VCS/URG |  

#### 4. 测试场景  
**4.1 基础逻辑测试**  
| ID | 场景 | 输入示例 |  
|----|------|----------|  
| BL-01 | 32-bit×4 AND | `src0=0xA5A5A5A5_DEADBEEF_12345678_87654321`, `src1=0x0F0F0F0F_CAFE1234_11111111_22222222` → 每通道按位与 |  
| BL-02 | 16-bit×8 XOR | `src0=0x0000FFFF_FFFF0000_1234AAAA_5555AAAA`, `src1=0x00000000_FFFF0000_0000AAAA_AAAA5555` → 每通道按位异或 |  
| BL-03 | 128-bit NOT | `src0=0xA5A5A5A5_DEADBEEF_12345678_87654321` → 逐位取反 |  

**4.2 选择器测试**  
| ID | 场景 | 触发条件 |  
|----|------|----------|  
| SL-01 | 选较大值（GT） | `dvr_logic_st`每通道`GT=1` → 输出对应通道`src0` |  
| SL-02 | 等值选择（EQ） | `dvr_logic_st`每通道`EQ=1` → 输出对应通道`src0` |  
| SL-03 | 多通道混合决策 | 不同通道GT/EQ/LS组合验证 |  

**4.3 移位操作测试**  
| ID | 场景 | 关键验证点 |  
|----|------|-------------|  
| SH-01 | 32-bit逻辑右移超界 | 每通道右移31位 → 结果为0 |  
| SH-02 | 16-bit算术右移符号扩展 | 负数右移 → 高位符号位填充 |  
| SH-03 | 循环移位循环性 | 32-bit旋转33位等效旋转1位 |  

**4.4 浮点状态集成测试**  
| ID | 场景 | 预期行为 |  
|----|------|----------|  
| FP-01 | 浮点状态冲突 | `dvr_logic_st`多通道不同状态 → 每通道独立决策 |  
| FP-02 | 非浮点操作忽略状态 | 基础逻辑操作中`dvr_logic_st`无效 |  

**4.5 特殊值测试**  
| ID | 场景 | 关键验证点 |  
|----|------|-------------|  
| SV-01 | 全0输入`get_first_one` | 返回0 |  
| SV-02 | 全1输入`get_first_zero` | 返回0 |  
| SV-03 | 移位量超限 | 32-bit移位40位等效移位8位 |  

#### 5. 验证环境  
| 工具 | 用途 |  
|------|------|  
| VCS | RTL编译/仿真 |  
| Verdi | 波形调试 |  
| SoftFloat | 黄金参考模型 |  
| URG | 覆盖率分析 |  

#### 6. 回归策略  
- 代码更新后自动触发全量测试集  
- 历史缺陷用例加入回归池（如符号扩展缺陷、全0输入处理）  
- 覆盖率未达标阻塞代码合入  

#### 7. 验收标准  
| 指标 | 要求 |  
|------|------|  
| 功能通过率 | 100% |  
| 行覆盖率 | ≥95% |  
| 边界用例 | 100%覆盖 |  
| 致命缺陷 | 0 |  

#### 附录：关键覆盖点  
| 覆盖组 | 覆盖目标 |  
|--------|----------|  
| **移位方向** | 左移/右移全组合 |  
| **精度切换** | 16-bit/32-bit模式切换 |  
| **浮点状态** | `dvr_logic_st`每通道3位独立覆盖 |  
| **符号扩展** | 负数算术右移高位补1 |  
| **特殊值** | 全0、全1、超限移位量 |  

